#!/usr/bin/env python3

import core.common as common
import plumbum.cli as cli

from virtual import ENVIRONMENTS


class App(cli.Application):
    '''
        A simple cli script that creates a virtual environment
        and activation file.
    '''

    PROGNAME = 'virtual'
    VERSION = '0.1.0'

    force = cli.Flag(
        ['f', '--force'],
        default=False,
        help=(
            'Download new environment even'
            ' if there\'s a cached one available'
        ),
    )

    no_cache = cli.Flag(
        ['--no-cache'],
        default=False,
        help=(
            'Don\'t create a cache or use'
            ' one when setting up the environment.'
        ),
    )

    @cli.positional(
        cli.Set(*ENVIRONMENTS.keys(), case_sensitive=False),
        str,
    )
    def main(self, environment, dest='.venv'):
        common.check_linux()
        env = ENVIRONMENTS[environment](dest=dest)
        env.init(use_cache=not self.no_cache, force=self.force)


if __name__ == '__main__':
    try:
        App.run()
    except KeyboardInterrupt as e:
        pass
